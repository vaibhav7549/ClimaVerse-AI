<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ClimaVerse AI - Cosmic Weather & AI Oracle</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://unpkg.com/three@0.156.1/build/three.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@300;400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="mobile.css">
    <style>
body {
    background: linear-gradient(135deg, #0a0a23, #1e3a8a);
    min-height: 100vh;
    font-family: 'Poppins', sans-serif;
    color: #ffffff;
    overflow-x: hidden;
    position: relative;
    margin: 0;
    font-size: clamp(12px, 2.2vmin, 14px);
    padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent; /* Prevent tap highlight on mobile */
}

#three-canvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
    opacity: 0.5; /* Lower opacity for mobile performance */
    will-change: transform;
    display: none; /* Disable on small screens by default, enabled in JS if needed */
}

#particles-js {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 2;
    display: none; /* Disable on small screens by default */
}

.container {
    position: relative;
    z-index: 10;
    padding: clamp(0.5rem, 3vmin, 1rem);
    max-width: 100%;
    margin: 0 auto;
    box-sizing: border-box;
}

.holographic-card {
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(0, 255, 255, 0.3);
    border-radius: clamp(0.4rem, 1.5vmin, 0.6rem);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    transition: transform 0.3s ease;
    padding: clamp(0.5rem, 2.5vmin, 1rem);
    box-sizing: border-box;
    backdrop-filter: none; /* Disable blur on mobile for performance */
}

.holographic-card:hover,
.holographic-card:active {
    transform: translateY(-0.2rem);
    box-shadow: 0 6px 25px rgba(0, 0, 0, 0.4);
}

.suggestion {
    cursor: pointer;
    padding: clamp(0.4rem, 2vmin, 0.6rem);
    background: rgba(255, 255, 255, 0.1);
    border-bottom: 1px solid rgba(0, 255, 255, 0.2);
    transition: background 0.2s ease, transform 0.2s ease;
    font-size: clamp(0.8rem, 2vmin, 0.9rem);
    touch-action: manipulation;
}

.suggestion:hover,
.suggestion:active {
    background: rgba(0, 255, 255, 0.3);
    transform: scale(1.02);
}

#map,
.chat-map {
    height: clamp(100px, 30vh, 200px);
    width: 100%;
    border-radius: clamp(0.4rem, 1.5vmin, 0.6rem);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(0, 255, 255, 0.3);
    box-sizing: border-box;
}

.input-neon {
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(0, 255, 255, 0.3);
    color: #ffffff;
    border-radius: clamp(0.3rem, 1.2vmin, 0.5rem);
    padding: clamp(0.4rem, 2vmin, 0.6rem);
    box-shadow: 0 0 10px rgba(0, 255, 255, 0.4);
    transition: box-shadow 0.2s ease;
    font-size: clamp(0.8rem, 2vmin, 0.9rem);
    width: 100%;
    box-sizing: border-box;
    min-height: 44px; /* Ensure touch target size */
}

.input-neon:focus {
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.7);
    outline: none;
}

.button-neon {
    background: linear-gradient(45deg, #00f7ff, #ff00cc);
    border: none;
    border-radius: clamp(0.3rem, 1.2vmin, 0.5rem);
    padding: clamp(0.4rem, 2vmin, 0.6rem);
    font-weight: 600;
    text-transform: uppercase;
    box-shadow: 0 0 10px rgba(0, 255, 255, 0.4);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    font-size: clamp(0.8rem, 2vmin, 0.9rem);
    width: 100%;
    cursor: pointer;
    touch-action: manipulation;
    min-height: 44px;
}

.button-neon:hover,
.button-neon:active {
    transform: scale(0.98); /* Subtle press effect */
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.7);
}

.chat-bubble {
    background: rgba(255, 255, 255, 0.08);
    border-radius: clamp(0.4rem, 1.5vmin, 0.6rem);
    padding: clamp(0.4rem, 2vmin, 0.6rem);
    margin-bottom: clamp(0.4rem, 1.5vmin, 0.6rem);
    border: 1px solid rgba(0, 255, 255, 0.2);
    font-size: clamp(0.8rem, 2vmin, 0.9rem);
}

.chat-bubble:hover,
.chat-bubble:active {
    transform: scale(1.01);
}

.weather-animation {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 5;
    display: none; /* Disable on mobile for performance */
}

.recent-city {
    cursor: pointer;
    padding: clamp(0.3rem, 1.2vmin, 0.5rem) clamp(0.5rem, 1.8vmin, 0.7rem);
    background: rgba(255, 255, 255, 0.1);
    border-radius: clamp(0.5rem, 1.5vmin, 0.75rem);
    transition: background 0.2s ease, transform 0.2s ease;
    font-size: clamp(0.8rem, 2vmin, 0.9rem);
    min-height: 44px;
}

.recent-city:hover,
.recent-city:active {
    background: rgba(0, 255, 255, 0.3);
    transform: scale(1.05);
}

.quick-reply {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(0, 255, 255, 0.2);
    border-radius: clamp(0.3rem, 1.2vmin, 0.5rem);
    padding: clamp(0.3rem, 1.2vmin, 0.5rem) clamp(0.5rem, 1.8vmin, 0.7rem);
    margin: clamp(0.2rem, 1vmin, 0.3rem);
    transition: background 0.2s ease, transform 0.2s ease;
    font-size: clamp(0.8rem, 2vmin, 0.9rem);
    cursor: pointer;
    min-height: 44px;
}

.quick-reply:hover,
.quick-reply:active {
    background: rgba(0, 255, 255, 0.3);
    transform: scale(1.05);
}

.typing-indicator {
    display: none;
    font-size: clamp(0.8rem, 2vmin, 0.9rem);
    color: rgba(255, 255, 255, 0.8);
    text-align: center;
    margin-bottom: clamp(0.4rem, 1.5vmin, 0.6rem);
}

.typing-indicator span {
    animation: blink 1s infinite;
}

.typing-indicator span:nth-child(2) {
    animation-delay: 0.2s;
}

.typing-indicator span:nth-child(3) {
    animation-delay: 0.4s;
}

@keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
}

h1, h2, h3 {
    font-family: 'Exo 2', sans-serif;
    line-height: 1.2;
}

/* Responsive Typography */
h1 {
    font-size: clamp(1.5rem, 6vmin, 2.5rem);
}

h2 {
    font-size: clamp(1.2rem, 4.5vmin, 1.8rem);
}

h3 {
    font-size: clamp(0.9rem, 3vmin, 1.2rem);
}

/* Dynamic Layouts */
#weatherDetails {
    display: grid;
    grid-template-columns: minmax(0, 1fr);
    gap: clamp(0.4rem, 1.5vmin, 0.6rem);
}

#recentCities,
#quickReplies {
    display: flex;
    flex-wrap: wrap;
    gap: clamp(0.4rem, 1.5vmin, 0.6rem);
    justify-content: center;
}

/* Media Queries for All Mobile Devices */
@media (min-width: 576px) {
    .container {
        padding: clamp(0.75rem, 2.5vmin, 1.25rem);
    }

    #weatherDetails {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    }

    h1 {
        font-size: clamp(1.8rem, 7vmin, 3rem);
    }
}

@media (min-width: 768px) {
    .container {
        max-width: 95%;
    }

    #weatherDetails {
        grid-template-columns: 2fr 1fr;
    }

    #map,
    .chat-map {
        height: clamp(150px, 35vh, 250px);
    }

    .holographic-card {
        padding: clamp(0.75rem, 2.5vmin, 1.25rem);
    }

    #three-canvas,
    #particles-js {
        display: block; /* Re-enable animations on larger screens */
    }
}

@media (min-width: 1024px) {
    .container {
        max-width: 90%;
    }

    #map,
    .chat-map {
        height: clamp(200px, 40vh, 300px);
    }

    h1 {
        font-size: clamp(2rem, 8vmin, 4rem);
    }
}

@media (min-width: 1440px) {
    .container {
        max-width: 1200px;
    }

    .holographic-card {
        padding: clamp(1rem, 3vmin, 1.5rem);
    }
}

@media (max-width: 576px) {
    body {
        font-size: clamp(11px, 2vmin, 13px);
    }

    .container {
        padding: clamp(0.4rem, 1.5vmin, 0.75rem);
    }

    .holographic-card {
        padding: clamp(0.4rem, 1.5vmin, 0.75rem);
        border-radius: 0.4rem;
    }

    #map,
    .chat-map {
        height: clamp(80px, 25vh, 150px);
    }

    .button-neon,
    .input-neon {
        padding: clamp(0.3rem, 1.2vmin, 0.5rem);
        font-size: clamp(0.75rem, 1.8vmin, 0.85rem);
    }

    .recent-city,
    .quick-reply,
    .suggestion {
        padding: clamp(0.2rem, 1vmin, 0.4rem);
        font-size: clamp(0.75rem, 1.8vmin, 0.85rem);
    }

    #chatMode .holographic-card {
        max-height: 65vh;
    }
}

@media (max-width: 360px) {
    body {
        font-size: 11px;
    }

    h1 {
        font-size: clamp(1.2rem, 5vmin, 2rem);
    }

    h2 {
        font-size: clamp(1rem, 3.5vmin, 1.5rem);
    }

    .container {
        padding: clamp(0.3rem, 1vmin, 0.5rem);
    }

    .button-neon,
    .input-neon {
        padding: 0.3rem;
        font-size: 0.75rem;
    }

    #map,
    .chat-map {
        height: clamp(70px, 20vh, 120px);
    }
}

@media (max-width: 320px) {
    body {
        font-size: 10px;
    }

    h1 {
        font-size: clamp(1rem, 4.5vmin, 1.8rem);
    }

    .holographic-card {
        padding: 0.3rem;
    }

    .button-neon,
    .input-neon {
        padding: 0.25rem;
        font-size: 0.7rem;
    }
}

/* Handle foldables and unusual aspect ratios */
@media (max-aspect-ratio: 1/1) {
    #map,
    .chat-map {
        height: clamp(70px, 20vh, 150px);
    }

    .container {
        padding: clamp(0.3rem, 1.5vmin, 0.6rem);
    }

    #weatherDetails {
        gap: clamp(0.3rem, 1vmin, 0.5rem);
    }
}

/* Touch device optimizations */
@media (hover: none) {
    .holographic-card:hover,
    .button-neon:hover,
    .suggestion:hover,
    .recent-city:hover,
    .quick-reply:hover,
    .chat-bubble:hover {
        transform: none;
        box-shadow: none;
    }

    .button-neon:active,
    .suggestion:active,
    .recent-city:active,
    .quick-reply:active,
    .chat-bubble:active {
        transform: scale(0.95);
    }
}

/* High-density displays */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    .holographic-card {
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    }

    .input-neon,
    .button-neon {
        box-shadow: 0 0 8px rgba(0, 255, 255, 0.4);
    }
}
    </style>
</head>
<body>
    <!-- Three.js Canvas -->
    <div id="three-canvas"></div>

    <!-- Particle Background -->
    <div id="particles-js"></div>

    <!-- Weather Animation -->
    <div id="weatherAnimation" class="weather-animation"></div>

    <!-- Main Container -->
    <div class="container mx-auto max-w-7xl">
        <header class="text-center mb-6">
            <h1 class="font-bold text-4xl sm:text-9xl">ClimaVerse AI</h1>
            <p class="text-sm mt-2 sm:text-3xl">Your Galactic Weather Explorer & AI Oracle</p>
        </header>

        <!-- Mode Toggle -->
        <div class="flex justify-center gap-2 mb-6">
            <button id="weatherModeBtn" class="button-neon px-4 py-2 sm:px-14 sm:py-5 sm:text-xl">Weather Cosmos</button>
            <button id="chatModeBtn" class="px-4 py-2 sm:px-14 sm:py-5 sm:text-xl bg-gray-900 text-white font-bold hover:bg-gray-950 transition">AI Nexus</button>
        </div>

        <!-- Weather Mode -->
        <div id="weatherMode" class="holographic-card p-4 sm:p-14">
            <h2 class="text-2xl sm:text-6xl font-bold mb-4 sm:mb-10 text-center">Explore the Cosmos</h2>
            <form id="weatherForm" class="relative mb-4 sm:mb-12">
                <label for="cityInput" class="sr-only">Search city</label>
                <input type="text" id="cityInput" placeholder="Search a city (e.g., Mumbai)" class="w-full input-neon text-base sm:text-xl" autocomplete="off" required aria-required="true">
                <div id="suggestions" class="absolute w-full bg-black/95 rounded-lg shadow-lg mt-1 sm:mt-3 max-h-48 sm:max-h-72 overflow-y-auto hidden z-40"></div>
                <button type="submit" class="w-full mt-4 button-neon text-base sm:text-xl">Discover Weather</button>
            </form>
            <div id="recentCities" class="flex flex-wrap gap-2 sm:gap-6 mb-4 sm:mb-10 justify-center"></div>
            <div id="weatherDetails" class="grid grid-cols-1 gap-4 sm:gap-10">
                <div class="space-y-4 sm:space-y-8">
                    <div class="flex items-center space-x-4 sm:space-x-10 bg-white/5 p-4 sm:p-8 rounded-lg sm:rounded-2xl">
                        <img id="weatherIcon" src="https://openweathermap.org/img/wn/01d@2x.png" alt="Weather Icon" class="w-16 h-16 sm:w-32 sm:h-32">
                        <div>
                            <p id="cityName" class="text-2xl sm:text-5xl font-bold">Enter a city</p>
                            <p id="temperature" class="text-3xl sm:text-7xl font-extrabold">25°C</p>
                            <p id="description" class="text-base sm:text-3xl capitalize">Sunny</p>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-2 sm:gap-6 text-sm sm:text-base">
                        <div class="bg-white/10 p-3 sm:p-6 rounded-lg sm:rounded-2xl">Humidity: <span id="humidity">60%</span></div>
                        <div class="bg-white/10 p-3 sm:p-6 rounded-lg sm:rounded-2xl">Wind: <span id="wind">5 m/s</span></div>
                        <div class="bg-white/10 p-3 sm:p-6 rounded-lg sm:rounded-2xl">Pressure: <span id="pressure">1012 hPa</span></div>
                        <div class="bg-white/10 p-3 sm:p-6 rounded-lg sm:rounded-2xl">AQI: <span id="aqi">N/A</span></div>
                    </div>
                </div>
                <div id="map" class="mt-4"></div>
            </div>
          <!-- Eco-Friendly Travel Planner with Weather Adjustment and City Suggestions -->
<div class="holographic-card p-4 sm:p-14 mt-4 sm:mt-10">
    <h2 class="text-2xl sm:text-6xl font-bold mb-4 sm:mb-10 text-center">Eco-Friendly Travel Planner</h2>
    <form id="travelForm" class="relative mb-4 sm:mb-12">
        <h3 class="text-lg sm:text-2xl font-exo mb-2 sm:mb-4 text-cyan-300">Enter Start Location</h3>
        <div class="relative">
            <label for="startLocation" class="sr-only">Start Location</label>
            <input type="text" id="startLocation" placeholder="e.g., New York City" class="w-full input-neon text-base sm:text-xl" autocomplete="off" required aria-required="true">
            <div id="startSuggestions" class="absolute w-full bg-black/95 rounded-lg shadow-lg mt-1 sm:mt-3 max-h-48 sm:max-h-72 overflow-y-auto hidden z-40"></div>
        </div>
        <h3 class="text-lg sm:text-2xl font-exo mb-2 sm:mb-4 text-cyan-300 mt-4 sm:mt-6">Enter Destination</h3>
        <div class="relative">
            <label for="destination" class="sr-only">Destination</label>
            <input type="text" id="destination" placeholder="e.g., Boston" class="w-full input-neon text-base sm:text-xl" autocomplete="off" required aria-required="true">
            <div id="destSuggestions" class="absolute w-full bg-black/95 rounded-lg shadow-lg mt-1 sm:mt-3 max-h-48 sm:max-h-72 overflow-y-auto hidden z-40"></div>
        </div>
        <h3 class="text-lg sm:text-2xl font-exo mb-2 sm:mb-4 text-cyan-300 mt-4 sm:mt-6">Select Preferences</h3>
        <div>
            <label for="preferences" class="sr-only">Preferences</label>
            <select id="preferences" multiple class="w-full input-neon text-base sm:text-xl bg-black/95">
                <option value="eco-friendly">Eco-Friendly</option>
                <option value="low cost">Low Cost</option>
                <option value="fast">Fast</option>
            </select>
        </div>
        <h3 class="text-lg sm:text-2xl font-exo mb-2 sm:mb-4 text-cyan-300 mt-4 sm:mt-6">Select Time Flexibility</h3>
        <div>
            <label for="timeFlexibility" class="sr-only">Time Flexibility</label>
            <select id="timeFlexibility" class="w-full input-neon text-base sm:text-xl bg-black/95">
                <option value="low">Low</option>
                <option value="medium">Medium</option>
                <option value="high">High</option>
            </select>
        </div>
        <button type="submit" class="w-full mt-4 button-neon text-base sm:text-xl">Plan Eco-Friendly Trip</button>
    </form>
    <div id="travelWeatherStatus" class="mb-4 sm:mb-6 text-sm sm:text-base"></div>
    <div id="travelResults" class="grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-6"></div>
</div>
        </div>

        <!-- AI Chat Mode -->
        <div id="chatMode" class="hidden">
            <div class="holographic-card p-4 sm:p-14 max-h-[60vh] sm:max-h-[800px] overflow-y-auto" id="chatBox">
                <div class="chat-bubble">
                    <p class="text-sm sm:text-xl">Welcome to ClimaVerse AI! Ask about weather (e.g., "Weather in Tokyo") or dive into the universe!</p>
                    <span class="text-xs sm:text-sm block mt-1 sm:mt-2 opacity-50">Just now</span>
                </div>
            </div>
            <div class="flex justify-between mt-4 gap-2">
                <button id="clearChatBtn" class="button-neon px-4 py-2 sm:px-6 sm:py-3 text-sm">Clear Chat</button>
                <button id="exportChatBtn" class="button-neon px-4 py-2 sm:px-6 sm:py-3 text-sm">Export Chat</button>
            </div>
            <div class="typing-indicator">
                ClimaVerse AI is thinking<span>.</span><span>.</span><span>.</span>
            </div>
            <div id="quickReplies" class="flex flex-wrap gap-2 sm:gap-4 mt-4 justify-center"></div>
            <form id="chatForm" class="relative mt-4">
                <label for="chatInput" class="sr-only">Ask a question</label>
                <input type="text" id="chatInput" name="content" placeholder="Ask about weather or anything..." class="w-full input-neon text-base sm:text-xl" required aria-required="true">
                <button type="submit" class="w-full mt-4 button-neon text-base sm:text-xl">Send Query</button>
            </form>
        </div>
    </div>

    <script>
        // Initialize Animations (Disabled on Mobile)
        function initAnimations() {
            if (window.innerWidth >= 768) {
                document.getElementById('three-canvas').style.display = 'block';
                document.getElementById('particles-js').style.display = 'block';
                document.getElementById('weatherAnimation').style.display = 'block';

                // Three.js
                const scene = new THREE.Scene();
                const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                const renderer = new THREE.WebGLRenderer({ alpha: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                document.getElementById("three-canvas").appendChild(renderer.domElement);
                const geometry = new THREE.SphereGeometry(0.5, 16, 16);
                const material = new THREE.MeshBasicMaterial({ color: 0x00f7ff, wireframe: true });
                const spheres = [];
                for (let i = 0; i < 20; i++) {
                    const sphere = new THREE.Mesh(geometry, material);
                    sphere.position.set(
                        (Math.random() - 0.5) * 100,
                        (Math.random() - 0.5) * 100,
                        (Math.random() - 0.5) * 100
                    );
                    scene.add(sphere);
                    spheres.push(sphere);
                }
                camera.position.z = 50;
                function animate() {
                    requestAnimationFrame(animate);
                    spheres.forEach(s => {
                        s.rotation.x += 0.01;
                        s.rotation.y += 0.01;
                    });
                    renderer.render(scene, camera);
                }
                animate();
                window.addEventListener("resize", () => {
                    camera.aspect = window.innerWidth / window.innerHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(window.innerWidth, window.innerHeight);
                });

                // Particles.js
                particlesJS("particles-js", {
                    particles: {
                        number: { value: 40, density: { enable: true, value_area: 1000 } },
                        color: { value: ["#00f7ff", "#ff00cc", "#ffffff"] },
                        shape: { type: "circle" },
                        opacity: { value: 0.6, random: true },
                        size: { value: 4, random: true },
                        line_linked: { enable: true, distance: 150, color: "#00f7ff", opacity: 0.3, width: 1 },
                        move: { enable: true, speed: 3, direction: "none", random: true }
                    },
                    interactivity: {
                        detect_on: "canvas",
                        events: { onhover: { enable: true, mode: "grab" }, onclick: { enable: true, mode: "push" } },
                        modes: { grab: { distance: 200, line_linked: { opacity: 0.5 } }, push: { particles_nb: 4 } }
                    }
                });
            }
        }
        initAnimations();
        window.addEventListener('resize', initAnimations);

        // GSAP Animations (Simplified for Mobile)
        gsap.from(".container", { duration: 0.8, y: 50, opacity: 0, ease: "power2.out" });
        gsap.from("header", { duration: 0.8, opacity: 0, ease: "power2.out" });

        // Initialize Leaflet Map
        const map = L.map('map', { zoomControl: window.innerWidth >= 768 }).setView([51.505, -0.09], 10);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
            maxZoom: 18,
        }).addTo(map);
        let marker;

        // Recent Cities
        let recentCities = JSON.parse(localStorage.getItem("recentCities") || "[]");
        function updateRecentCities(city, lat, lon) {
            recentCities = recentCities.filter(c => c.city !== city);
            recentCities.unshift({ city, lat, lon });
            if (recentCities.length > 5) recentCities.pop();
            localStorage.setItem("recentCities", JSON.stringify(recentCities));
            renderRecentCities();
        }
        function renderRecentCities() {
            const recentCitiesDiv = document.getElementById("recentCities");
            recentCitiesDiv.innerHTML = recentCities.length ? "<h3 class='text-lg sm:text-2xl text-white/80 mb-2 sm:mb-6 text-center'>Recent Searches</h3>" : "";
            recentCities.forEach(({ city, lat, lon }) => {
                const div = document.createElement("div");
                div.className = "recent-city text-sm sm:text-lg";
                div.textContent = city;
                div.addEventListener("click", () => fetchWeather(lat, lon, city, false));
                recentCitiesDiv.appendChild(div);
            });
            gsap.from(".recent-city", { duration: 0.6, opacity: 0, x: -30, stagger: 0.2 });
        }
        renderRecentCities();

        // Quick Replies
        const quickReplies = [
            "Weather in Mumbai",
            "Weather in Tokyo",
            "Tell me about AI",
            "What is the universe?"
        ];
        function renderQuickReplies() {
            const quickRepliesDiv = document.getElementById("quickReplies");
            quickRepliesDiv.innerHTML = "";
            quickReplies.forEach(reply => {
                const btn = document.createElement("button");
                btn.className = "quick-reply text-sm sm:text-lg";
                btn.textContent = reply;
                btn.addEventListener("click", () => {
                    document.getElementById("chatInput").value = reply;
                    document.getElementById("chatForm").dispatchEvent(new Event("submit"));
                });
                quickRepliesDiv.appendChild(btn);
            });
            gsap.from(".quick-reply", { duration: 0.6, opacity: 0, y: 20, stagger: 0.2 });
        }
        renderQuickReplies();

        // Toggle Modes
        const weatherModeBtn = document.getElementById("weatherModeBtn");
        const chatModeBtn = document.getElementById("chatModeBtn");
        const weatherMode = document.getElementById("weatherMode");
        const chatMode = document.getElementById("chatMode");

        weatherModeBtn.addEventListener("click", () => {
            weatherMode.classList.remove("hidden");
            chatMode.classList.add("hidden");
            weatherModeBtn.classList.replace("bg-gray-900", "button-neon");
            chatModeBtn.classList.replace("button-neon", "bg-gray-900");
            gsap.from("#weatherMode", { duration: 0.8, opacity: 0, y: 50, ease: "power2.out" });
        });

        chatModeBtn.addEventListener("click", () => {
            chatMode.classList.remove("hidden");
            weatherMode.classList.add("hidden");
            chatModeBtn.classList.replace("bg-gray-900", "button-neon");
            weatherModeBtn.classList.replace("button-neon", "bg-gray-900");
            gsap.from("#chatMode", { duration: 0.8, opacity: 0, y: 50, ease: "power2.out" });
        });

        // City Suggestions
        const cityInput = document.getElementById("cityInput");
        const suggestions = document.getElementById("suggestions");
        const fetchSuggestions = _.debounce(async (query) => {
            if (query.length < 2) {
                suggestions.classList.add("hidden");
                suggestions.innerHTML = "";
                return;
            }
            try {
                const response = await fetch(`/api/geocode?q=${encodeURIComponent(query)}`);
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                const cities = await response.json();
                suggestions.innerHTML = "";
                if (cities.length > 0) {
                    cities.forEach(city => {
                        const div = document.createElement("div");
                        div.className = "suggestion text-sm sm:text-lg";
                        div.textContent = `${city.name}, ${city.country}${city.state ? `, ${city.state}` : ""}`;
                        div.dataset.lat = city.lat;
                        div.dataset.lon = city.lon;
                        div.addEventListener("click", () => {
                            cityInput.value = city.name;
                            suggestions.classList.add("hidden");
                            fetchWeather(city.lat, city.lon, city.name, false);
                        });
                        suggestions.appendChild(div);
                    });
                    suggestions.classList.remove("hidden");
                    gsap.from(".suggestion", { duration: 0.5, opacity: 0, y: 20, stagger: 0.15 });
                } else {
                    suggestions.innerHTML = '<div class="p-2 sm:p-5 text-sm sm:text-lg text-white/80">No cities found</div>';
                    suggestions.classList.remove("hidden");
                }
            } catch (error) {
                console.error("Error fetching city suggestions:", error);
                suggestions.innerHTML = '<div class="p-2 sm:p-5 text-sm sm:text-lg text-white/80">Error fetching suggestions</div>';
                suggestions.classList.remove("hidden");
            }
        }, 300);

        cityInput.addEventListener("input", () => fetchSuggestions(cityInput.value.trim()));
        document.addEventListener("click", (e) => {
            if (!cityInput.contains(e.target) && !suggestions.contains(e.target)) {
                suggestions.classList.add("hidden");
            }
        });

        // Fetch Weather
        async function fetchWeather(lat, lon, cityName, isChat = false) {
            try {
                const response = await fetch(`/api/weather?lat=${lat}&lon=${lon}`);
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                const { weather, aqi } = await response.json();

                const weatherInfo = {
                    city: cityName,
                    temp: Math.round(weather.main.temp),
                    description: weather.weather[0].description,
                    icon: `https://openweathermap.org/img/wn/${weather.weather[0].icon}@2x.png`,
                    humidity: weather.main.humidity,
                    wind: weather.wind.speed,
                    pressure: weather.main.pressure,
                    aqi: aqi.list[0].main.aqi,
                    aqiText: ["Good", "Fair", "Moderate", "Poor", "Very Poor"][aqi.list[0].main.aqi - 1]
                };

                if (isChat) {
                    const chatBox = document.getElementById("chatBox");
                    const weatherBubble = document.createElement("div");
                    weatherBubble.className = "chat-bubble";
                    weatherBubble.innerHTML = `
                        <div class="bg-white/10 p-4 sm:p-8 rounded-lg sm:rounded-2xl">
                            <h3 class="text-lg sm:text-3xl font-bold">${weatherInfo.city}</h3>
                            <div class="flex items-center space-x-4 sm:space-x-8 mt-2 sm:mt-6">
                                <img src="${weatherInfo.icon}" alt="Weather Icon" class="w-12 h-12 sm:w-24 sm:h-24">
                                <div>
                                    <p class="text-2xl sm:text-5xl font-bold">${weatherInfo.temp}°C</p>
                                    <p class="text-base sm:text-2xl capitalize">${weatherInfo.description}</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-2 sm:gap-6 mt-4 sm:mt-8 text-sm sm:text-base">
                                <p>Humidity: ${weatherInfo.humidity}%</p>
                                <p>Wind: ${weatherInfo.wind} m/s</p>
                                <p>Pressure: ${weatherInfo.pressure} hPa</p>
                                <p>AQI: ${weatherInfo.aqiText} (${weatherInfo.aqi})</p>
                            </div>
                            <div id="chatMap-${lat}-${lon}" class="chat-map mt-4 sm:mt-8"></div>
                            <span class="text-xs sm:text-sm block mt-2 sm:mt-4 opacity-50">${new Date().toLocaleString()}</span>
                        </div>
                    `;
                    chatBox.appendChild(weatherBubble);
                    chatBox.scrollTop = chatBox.scrollHeight;

                    const chatMap = L.map(`chatMap-${lat}-${lon}`, { zoomControl: window.innerWidth >= 768 }).setView([lat, lon], 10);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
                        maxZoom: 18,
                    }).addTo(chatMap);
                    L.marker([lat, lon]).addTo(chatMap)
                        .bindPopup(`<b>${cityName}</b><br>${weatherInfo.description}`)
                        .openPopup();

                    gsap.from(weatherBubble, { duration: 0.8, opacity: 0, x: -40, ease: "power2.out" });
                } else {
                    document.getElementById("cityName").textContent = weatherInfo.city;
                    document.getElementById("temperature").textContent = `${weatherInfo.temp}°C`;
                    document.getElementById("description").textContent = weatherInfo.description;
                    document.getElementById("weatherIcon").src = weatherInfo.icon;
                    document.getElementById("humidity").textContent = `${weatherInfo.humidity}%`;
                    document.getElementById("wind").textContent = `${weatherInfo.wind} m/s`;
                    document.getElementById("pressure").textContent = `${weatherInfo.pressure} hPa`;
                    document.getElementById("aqi").textContent = `${weatherInfo.aqiText} (${weatherInfo.aqi})`;

                    map.setView([lat, lon], 10);
                    if (marker) map.removeLayer(marker);
                    marker = L.marker([lat, lon]).addTo(map)
                        .bindPopup(`<b>${cityName}</b><br>${weatherInfo.description}`)
                        .openPopup();

                    updateRecentCities(cityName, lat, lon);
                    gsap.from("#weatherDetails", { duration: 0.8, opacity: 0, y: 40, ease: "power2.out" });
                }

                if (window.innerWidth >= 768) {
                    updateWeatherAnimation(weatherInfo.description);
                }
            } catch (error) {
                console.error("Error fetching weather data:", error);
                if (isChat) {
                    const chatBox = document.getElementById("chatBox");
                    const errorBubble = document.createElement("div");
                    errorBubble.className = "chat-bubble";
                    errorBubble.innerHTML = `
                        <p class="text-sm sm:text-xl">Unable to fetch weather for ${cityName}. Please try again!</p>
                        <span class="text-xs sm:text-sm block mt-2 opacity-50">${new Date().toLocaleString()}</span>
                    `;
                    chatBox.appendChild(errorBubble);
                    chatBox.scrollTop = chatBox.scrollHeight;
                    gsap.from(errorBubble, { duration: 0.8, opacity: 0, x: -40 });
                } else {
                    alert("Unable to fetch weather data. Please try another city.");
                }
            }
        }

        // Weather Animation
        function updateWeatherAnimation(description) {
            const weatherAnimation = document.getElementById("weatherAnimation");
            weatherAnimation.innerHTML = "";
            if (description.includes("rain")) {
                for (let i = 0; i < 50; i++) {
                    const drop = document.createElement("div");
                    drop.className = "absolute bg-cyan-300/60 w-1 h-6 rounded";
                    drop.style.left = `${Math.random() * 100}%`;
                    drop.style.top = `${Math.random() * 100}%`;
                    drop.style.animation = `rain 0.7s linear infinite`;
                    drop.style.animationDelay = `${Math.random()}s`;
                    weatherAnimation.appendChild(drop);
                }
                const style = document.createElement("style");
                style.textContent = `
                    @keyframes rain {
                        0% { transform: translateY(-20px); opacity: 1; }
                        100% { transform: translateY(100vh); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            } else if (description.includes("snow")) {
                for (let i = 0; i < 40; i++) {
                    const flake = document.createElement("div");
                    flake.className = "absolute bg-white w-2 h-2 rounded-full";
                    flake.style.left = `${Math.random() * 100}%`;
                    flake.style.top = `${Math.random() * 100}%`;
                    flake.style.animation = `snow 2s linear infinite`;
                    flake.style.animationDelay = `${Math.random() * 2}s`;
                    weatherAnimation.appendChild(flake);
                }
                const style = document.createElement("style");
                style.textContent = `
                    @keyframes snow {
                        0% { transform: translateY(-20px); opacity: 1; }
                        100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            } else if (description.includes("clear") || description.includes("sun")) {
                for (let i = 0; i < 10; i++) {
                    const flare = document.createElement("div");
                    flare.className = "absolute bg-yellow-300/30 w-3 h-3 rounded-full";
                    flare.style.left = `${Math.random() * 100}%`;
                    flare.style.top = `${Math.random() * 100}%`;
                    flare.style.animation = `flare 2s ease-in-out infinite`;
                    flare.style.animationDelay = `${Math.random() * 2}s`;
                    weatherAnimation.appendChild(flare);
                }
                const style = document.createElement("style");
                style.textContent = `
                    @keyframes flare {
                        0%, 100% { transform: scale(1); opacity: 0.3; }
                        50% { transform: scale(1.3); opacity: 0.7; }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // Weather Form Submission
        const weatherForm = document.getElementById("weatherForm");
        weatherForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            const city = cityInput.value.trim();
            try {
                const response = await fetch(`/api/geocode?q=${encodeURIComponent(city)}`);
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                const cities = await response.json();
                if (cities.length > 0) {
                    const { lat, lon, name } = cities[0];
                    fetchWeather(lat, lon, name, false);
                } else {
                    alert("City not found! Please try another city.");
                }
            } catch (error) {
                console.error("Error fetching city data:", error);
                alert("Error fetching city data. Please try again.");
            }
        });

        // AI Chat Features
        const chatForm = document.getElementById("chatForm");
        const chatBox = document.getElementById("chatBox");
        const typingIndicator = document.querySelector(".typing-indicator");
        const clearChatBtn = document.getElementById("clearChatBtn");
        const exportChatBtn = document.getElementById("exportChatBtn");

        clearChatBtn.addEventListener("click", () => {
            chatBox.innerHTML = `
                <div class="chat-bubble">
                    <p class="text-sm sm:text-xl">Welcome to ClimaVerse AI! Ask about weather (e.g., "Weather in Tokyo") or dive into the universe!</p>
                    <span class="text-xs sm:text-sm block mt-2 opacity-50">${new Date().toLocaleString()}</span>
                </div>
            `;
            gsap.from(".chat-bubble", { duration: 0.8, opacity: 0, y: 40 });
        });

        exportChatBtn.addEventListener("click", () => {
            const messages = Array.from(chatBox.querySelectorAll(".chat-bubble")).map(bubble => {
                const text = bubble.querySelector("p").textContent;
                const time = bubble.querySelector("span")?.textContent || "";
                return `${time}: ${text}`;
            }).join("\n\n");
            const blob = new Blob([messages], { type: "text/plain" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = `ClimaVerseAI_Chat_${new Date().toISOString().split("T")[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        });

        chatForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            const userInput = document.getElementById("chatInput").value.trim();

            const userBubble = document.createElement("div");
            userBubble.className = "chat-bubble text-right";
            userBubble.innerHTML = `
                <p class="text-sm sm:text-xl">${userInput}</p>
                <span class="text-xs sm:text-sm block mt-2 opacity-50">${new Date().toLocaleString()}</span>
            `;
            chatBox.appendChild(userBubble);
            chatBox.scrollTop = chatBox.scrollHeight;
            gsap.from(userBubble, { duration: 0.8, opacity: 0, x: 40 });

            typingIndicator.style.display = "block";
            gsap.from(".typing-indicator", { duration: 0.6, opacity: 0 });

            const weatherRegex = /(weather|forecast)\s+(in|for|at)\s+([a-zA-Z\s]+)/i;
            const match = userInput.match(weatherRegex);
            if (match) {
                const city = match[3].trim();
                try {
                    const response = await fetch(`/api/geocode?q=${encodeURIComponent(city)}`);
                    if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                    const cities = await response.json();
                    if (cities.length > 0) {
                        const { lat, lon, name } = cities[0];
                        await fetchWeather(lat, lon, name, true);
                    } else {
                        const errorBubble = document.createElement("div");
                        errorBubble.className = "chat-bubble";
                        errorBubble.innerHTML = `
                            <p class="text-sm sm:text-xl">City "${city}" not found. Try another city!</p>
                            <span class="text-xs sm:text-sm block mt-2 opacity-50">${new Date().toLocaleString()}</span>
                        `;
                        chatBox.appendChild(errorBubble);
                        chatBox.scrollTop = chatBox.scrollHeight;
                        gsap.from(errorBubble, { duration: 0.8, opacity: 0, x: -40 });
                    }
                } catch (error) {
                    console.error("Error fetching city data:", error);
                    const errorBubble = document.createElement("div");
                    errorBubble.className = "chat-bubble";
                    errorBubble.innerHTML = `
                        <p class="text-sm sm:text-xl">Error fetching weather for "${city}". Please try again!</p>
                        <span class="text-xs sm:text-sm block mt-2 opacity-50">${new Date().toLocaleString()}</span>
                    `;
                    chatBox.appendChild(errorBubble);
                    chatBox.scrollTop = chatBox.scrollHeight;
                    gsap.from(errorBubble, { duration: 0.8, opacity: 0, x: -40 });
                }
            } else {
                try {
                    const response = await fetch("/", {
                        method: "POST",
                        headers: { "Content-Type": "application/x-www-form-urlencoded" },
                        body: `content=${encodeURIComponent(userInput)}`
                    });
                    if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                    const aiResponse = await response.text();

                    const aiBubble = document.createElement("div");
                    aiBubble.className = "chat-bubble";
                    aiBubble.innerHTML = `
                        <p class="text-sm sm:text-xl">${aiResponse || "Error: No response"}</p>
                        <span class="text-xs sm:text-sm block mt-2 opacity-50">${new Date().toLocaleString()}</span>
                    `;
                    chatBox.appendChild(aiBubble);
                    chatBox.scrollTop = chatBox.scrollHeight;
                    gsap.from(aiBubble, { duration: 0.8, opacity: 0, x: -40 });
                } catch (error) {
                    console.error("Error fetching AI response:", error);
                    const errorBubble = document.createElement("div");
                    errorBubble.className = "chat-bubble";
                    errorBubble.innerHTML = `
                        <p class="text-sm sm:text-xl">Error: Could not connect to AI</p>
                        <span class="text-xs sm:text-sm block mt-2 opacity-50">${new Date().toLocaleString()}</span>
                    `;
                    chatBox.appendChild(errorBubble);
                    chatBox.scrollTop = chatBox.scrollHeight;
                    gsap.from(errorBubble, { duration: 0.8, opacity: 0, x: -40 });
                }
            }

            typingIndicator.style.display = "none";
            chatForm.reset();
        });






       // Eco-Friendly Travel Planner with Weather Adjustment and City Suggestions
const travelForm = document.getElementById("travelForm");
const travelResults = document.getElementById("travelResults");
const travelWeatherStatus = document.getElementById("travelWeatherStatus");
const startInput = document.getElementById("startLocation");
const destInput = document.getElementById("destination");
const startSuggestions = document.getElementById("startSuggestions");
const destSuggestions = document.getElementById("destSuggestions");

// Reuse existing fetchSuggestions logic for city suggestions
const fetchCitySuggestions = _.debounce(async (query, suggestionDiv, inputElement) => {
    if (query.length < 2) {
        suggestionDiv.classList.add("hidden");
        suggestionDiv.innerHTML = "";
        return;
    }
    try {
        const response = await fetch(`/api/geocode?q=${encodeURIComponent(query)}`);
        if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
        const cities = await response.json();
        suggestionDiv.innerHTML = "";
        if (cities.length > 0) {
            cities.forEach(city => {
                const div = document.createElement("div");
                div.className = "suggestion text-sm sm:text-lg";
                div.textContent = `${city.name}, ${city.country}${city.state ? `, ${city.state}` : ""}`;
                div.dataset.lat = city.lat;
                div.dataset.lon = city.lon;
                div.addEventListener("click", () => {
                    inputElement.value = city.name;
                    suggestionDiv.classList.add("hidden");
                });
                suggestionDiv.appendChild(div);
            });
            suggestionDiv.classList.remove("hidden");
            gsap.from(".suggestion", { duration: 0.5, opacity: 0, y: 20, stagger: 0.15 });
        } else {
            suggestionDiv.innerHTML = '<div class="p-2 sm:p-5 text-sm sm:text-lg text-white/80">No cities found</div>';
            suggestionDiv.classList.remove("hidden");
        }
    } catch (error) {
        console.error("Error fetching city suggestions:", error);
        suggestionDiv.innerHTML = '<div class="p-2 sm:p-5 text-sm sm:text-lg text-white/80">Error fetching suggestions</div>';
        suggestionDiv.classList.remove("hidden");
    }
}, 300);

// Event listeners for city suggestions
startInput.addEventListener("input", () => fetchCitySuggestions(startInput.value.trim(), startSuggestions, startInput));
destInput.addEventListener("input", () => fetchCitySuggestions(destInput.value.trim(), destSuggestions, destInput));

// Hide suggestions when clicking outside
document.addEventListener("click", (e) => {
    if (!startInput.contains(e.target) && !startSuggestions.contains(e.target)) {
        startSuggestions.classList.add("hidden");
    }
    if (!destInput.contains(e.target) && !destSuggestions.contains(e.target)) {
        destSuggestions.classList.add("hidden");
    }
});

async function fetchWeatherForCity(city) {
    try {
        const geoResponse = await fetch(`/api/geocode?q=${encodeURIComponent(city)}`);
        if (!geoResponse.ok) throw new Error(`Geocode HTTP error! Status: ${geoResponse.status}`);
        const cities = await geoResponse.json();
        if (cities.length === 0) return null;

        const { lat, lon } = cities[0];
        const weatherResponse = await fetch(`/api/weather?lat=${lat}&lon=${lon}`);
        if (!weatherResponse.ok) throw new Error(`Weather HTTP error! Status: ${weatherResponse.status}`);
        const { weather } = await weatherResponse.json();
        return weather.weather[0].description.toLowerCase();
    } catch (error) {
        console.error(`Error fetching weather for ${city}:`, error);
        return null;
    }
}

travelForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    const start = startInput.value.trim();
    const dest = destInput.value.trim();
    const prefs = Array.from(document.getElementById("preferences").selectedOptions).map(opt => opt.value);
    const timeFlex = document.getElementById("timeFlexibility").value;

    const data = {
        start_location: start,
        destination: dest,
        preferences: prefs,
        time_flexibility: timeFlex
    };

    // Fetch weather for start and destination
    travelWeatherStatus.innerHTML = "";
    let weatherNotes = [];
    const startWeather = await fetchWeatherForCity(start);
    const destWeather = await fetchWeatherForCity(dest);
    const adverseConditions = ["rain", "snow", "storm"];
    let avoidModes = [];

    if (startWeather && adverseConditions.some(cond => startWeather.includes(cond))) {
        avoidModes = ["cycling", "walking"];
        weatherNotes.push(`Avoided cycling/walking due to ${startWeather} in ${start}`);
    }
    if (destWeather && adverseConditions.some(cond => destWeather.includes(cond))) {
        avoidModes = ["cycling", "walking"];
        weatherNotes.push(`Avoided cycling/walking due to ${destWeather} in ${dest}`);
    }

    try {
        const response = await fetch("/plan_trip", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
        });
        if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
        const result = await response.json();

        travelResults.innerHTML = "";
        if (result.error) {
            const errorDiv = document.createElement("div");
            errorDiv.className = "bg-white/10 p-4 sm:p-6 rounded-lg sm:rounded-2xl text-sm sm:text-base";
            errorDiv.textContent = result.error;
            travelResults.appendChild(errorDiv);
        } else {
            // Filter out routes with avoided modes
            let filteredOptions = Object.entries(result).filter(([_, option]) => {
                const modes = option.transport_mode.toLowerCase();
                return !avoidModes.some(mode => modes.includes(mode));
            });

            // If all routes are filtered out, show a fallback message
            if (filteredOptions.length === 0) {
                const fallbackDiv = document.createElement("div");
                fallbackDiv.className = "bg-white/10 p-4 sm:p-6 rounded-lg sm:rounded-2xl text-sm sm:text-base";
                fallbackDiv.textContent = "No eco-friendly routes available due to adverse weather. Try other transport modes.";
                travelResults.appendChild(fallbackDiv);
            } else {
                // Display up to 3 valid routes
                filteredOptions.slice(0, 3).forEach(([key, option]) => {
                    const optionDiv = document.createElement("div");
                    optionDiv.className = "bg-white/10 p-4 sm:p-6 rounded-lg sm:rounded-2xl";
                    optionDiv.innerHTML = `
                        <h3 class="text-lg sm:text-2xl font-bold mb-2">${key.replace('_', ' ').toUpperCase()}</h3>
                        <p><strong>Transport:</strong> ${option.transport_mode}</p>
                        <p><strong>Time:</strong> ${option.estimated_time}</p>
                        <p><strong>Emissions:</strong> ${option.estimated_emissions}</p>
                        <p><strong>Notes:</strong> ${option.notes}</p>
                    `;
                    travelResults.appendChild(optionDiv);
                });
            }

            // Display weather status
            if (weatherNotes.length > 0) {
                travelWeatherStatus.className = "bg-white/10 p-4 sm:p-6 rounded-lg sm:rounded-2xl text-sm sm:text-base";
                travelWeatherStatus.textContent = weatherNotes.join(" and ");
                gsap.from(travelWeatherStatus, { duration: 0.8, opacity: 0, y: 40, ease: "power2.out" });
            }
        }
        gsap.from("#travelResults > div", { duration: 0.8, opacity: 0, y: 40, stagger: 0.2, ease: "power2.out" });
    } catch (error) {
        console.error("Error fetching travel plan:", error);
        travelResults.innerHTML = `
            <div class="bg-white/10 p-4 sm:p-6 rounded-lg sm:rounded-2xl text-sm sm:text-base">
                Error planning trip. Please try again!
            </div>
        `;
        gsap.from("#travelResults > div", { duration: 0.8, opacity: 0, y: 40, ease: "power2.out" });
    }
});
    </script>
</body>
</html>
